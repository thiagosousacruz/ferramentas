<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ficha T√©cnica do Produto üìù</title>
  <style>
    :root {
      --cor-fundo: #f9fafb;       /* Fundo claro e neutro */
      --cor-texto: #333333;       /* Texto escuro */
      --cor-botao: #007BFF;       /* Azul para bot√µes */
      --cor-botao-hover: #0056b3;  /* Azul mais escuro no hover */
      --cor-titulo: #2c3e50;      /* Azul escuro para o t√≠tulo */
    }
    body {
      background-color: var(--cor-fundo);
      color: var(--cor-texto);
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
      color: var(--cor-titulo);
    }
    h2 {
      text-align: center;
      color: var(--cor-titulo);
    }
    h3, h4 {
      color: var(--cor-titulo);
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin: 2px 0;
      box-sizing: border-box;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .btn {
      background: var(--cor-botao);
      color: #fff;
      border: none;
      cursor: pointer;
      margin-top: 5px;
      border-radius: 4px;
    }
    .btn:hover {
      background: var(--cor-botao-hover);
    }
    @media(max-width: 600px) {
      input, select, button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ficha T√©cnica do Produto üìù</h1>
    
    <!-- Campo do nome do produto -->
    <div class="form-group">
      <label for="productName">Nome do Produto</label>
      <input type="text" id="productName" placeholder="Digite o nome do produto">
    </div>
    
    <!-- Se√ß√£o de Mat√©rias Primas -->
    <h2>Mat√©rias Primas</h2>
    <table id="rawMaterialsTable">
      <thead>
        <tr>
          <th>Descri√ß√£o</th>
          <th>Quantidade</th>
          <th>Unidade</th>
          <th>Custo Unit√°rio</th>
          <th>Custo Total</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        <!-- Linhas adicionadas dinamicamente -->
      </tbody>
    </table>
    <button class="btn" onclick="addRawMaterial()">Adicionar Mat√©ria Prima</button>
    
    <!-- Se√ß√£o de M√£o de Obra -->
    <h2>M√£o de Obra</h2>
    <table id="laborTable">
      <thead>
        <tr>
          <th>Tempo Gasto</th>
          <th>Unidade</th>
          <th>Custo por Unidade</th>
          <th>Custo Total</th>
          <th>A√ß√£o</th>
        </tr>
      </thead>
      <tbody>
        <!-- Linhas adicionadas dinamicamente -->
      </tbody>
    </table>
    <button class="btn" onclick="addLabor()">Adicionar M√£o de Obra</button>
    
    <!-- Campo para a Margem de Lucro -->
    <div class="form-group">
      <label for="profitMargin">Margem de Lucro (%)</label>
      <input type="number" id="profitMargin" placeholder="Ex: 20" value="0" min="0">
    </div>
    
    <!-- Bot√£o para gerar a ficha t√©cnica -->
    <button class="btn" onclick="generateSheet()">Gerar Ficha T√©cnica</button>
    
    <!-- √Årea para exibir a ficha t√©cnica gerada -->
    <div id="technicalSheet" style="display:none; margin-top:20px;">
      <h2>Ficha T√©cnica Gerada</h2>
      <div id="sheetContent"></div>
      <button class="btn" onclick="exportToExcel()">Exportar para Excel</button>
      <button class="btn" onclick="exportToPDF()">Exportar para PDF</button>
    </div>
  </div>
  
  <!-- Biblioteca jsPDF para exporta√ß√£o para PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    // Fun√ß√£o auxiliar para formatar n√∫meros como moeda brasileira (R$)
    function formatCurrency(value) {
      return value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }
    
    // Adiciona uma linha de mat√©ria prima na tabela
    function addRawMaterial() {
      const table = document.getElementById('rawMaterialsTable').getElementsByTagName('tbody')[0];
      const row = table.insertRow();
      
      // Coluna: Descri√ß√£o
      let cell = row.insertCell();
      cell.innerHTML = '<input type="text" placeholder="Descri√ß√£o" oninput="updateRawMaterialCost(this)">';
      
      // Coluna: Quantidade
      cell = row.insertCell();
      cell.innerHTML = '<input type="number" value="0" min="0" oninput="updateRawMaterialCost(this)">';
      
      // Coluna: Unidade
      cell = row.insertCell();
      cell.innerHTML = '<select onchange="updateRawMaterialCost(this)"><option value="un">un</option><option value="kg">kg</option><option value="g">g</option><option value="L">L</option><option value="mL">mL</option></select>';
      
      // Coluna: Custo Unit√°rio
      cell = row.insertCell();
      cell.innerHTML = '<input type="number" value="0" min="0" step="0.01" oninput="updateRawMaterialCost(this)">';
      
      // Coluna: Custo Total (calculado automaticamente)
      cell = row.insertCell();
      cell.innerHTML = '<span>' + formatCurrency(0) + '</span>';
      
      // Coluna: A√ß√£o (bot√£o para remover linha)
      cell = row.insertCell();
      cell.innerHTML = '<button class="btn" onclick="removeRow(this)">Remover</button>';
    }
    
    // Atualiza o custo total da mat√©ria prima (quantidade * custo unit√°rio)
    function updateRawMaterialCost(element) {
      const row = element.parentElement.parentElement;
      const qty = parseFloat(row.cells[1].querySelector('input').value) || 0;
      const unitCost = parseFloat(row.cells[3].querySelector('input').value) || 0;
      const totalCost = qty * unitCost;
      row.cells[4].querySelector('span').textContent = formatCurrency(totalCost);
      updateSummary();
    }
    
    // Adiciona uma linha de m√£o de obra na tabela
    function addLabor() {
      const table = document.getElementById('laborTable').getElementsByTagName('tbody')[0];
      const row = table.insertRow();
      
      // Coluna: Tempo Gasto
      let cell = row.insertCell();
      cell.innerHTML = '<input type="number" value="0" min="0" oninput="updateLaborCost(this)">';
      
      // Coluna: Unidade (horas ou minutos)
      cell = row.insertCell();
      cell.innerHTML = '<select onchange="updateLaborCost(this)"><option value="horas">Horas</option><option value="minutos">Minutos</option></select>';
      
      // Coluna: Custo por Unidade
      cell = row.insertCell();
      cell.innerHTML = '<input type="number" value="0" min="0" step="0.01" oninput="updateLaborCost(this)">';
      
      // Coluna: Custo Total (calculado automaticamente)
      cell = row.insertCell();
      cell.innerHTML = '<span>' + formatCurrency(0) + '</span>';
      
      // Coluna: A√ß√£o (bot√£o para remover linha)
      cell = row.insertCell();
      cell.innerHTML = '<button class="btn" onclick="removeRow(this)">Remover</button>';
    }
    
    // Atualiza o custo total da m√£o de obra
    function updateLaborCost(element) {
      const row = element.parentElement.parentElement;
      let time = parseFloat(row.cells[0].querySelector('input').value) || 0;
      const unit = row.cells[1].querySelector('select').value;
      const costPerUnit = parseFloat(row.cells[2].querySelector('input').value) || 0;
      
      // Se a unidade for minutos, converte para horas para o c√°lculo
      if (unit === 'minutos') {
        time = time / 60;
      }
      
      const totalCost = time * costPerUnit;
      row.cells[3].querySelector('span').textContent = formatCurrency(totalCost);
      updateSummary();
    }
    
    // Remove a linha da tabela
    function removeRow(button) {
      const row = button.parentElement.parentElement;
      row.parentElement.removeChild(row);
      updateSummary();
    }
    
    // Atualiza os totais para exibir no resumo da ficha t√©cnica
    function updateSummary() {
      let totalRaw = 0;
      let totalLabor = 0;
      
      // Soma os custos totais das mat√©rias primas
      const rawRows = document.getElementById('rawMaterialsTable').getElementsByTagName('tbody')[0].rows;
      for (let row of rawRows) {
        // Remove s√≠mbolos e converte para n√∫mero
        let costText = row.cells[4].querySelector('span').textContent.replace(/[R$\s.]/g, '').replace(',', '.');
        totalRaw += parseFloat(costText) || 0;
      }
      
      // Soma os custos totais da m√£o de obra
      const laborRows = document.getElementById('laborTable').getElementsByTagName('tbody')[0].rows;
      for (let row of laborRows) {
        let costText = row.cells[3].querySelector('span').textContent.replace(/[R$\s.]/g, '').replace(',', '.');
        totalLabor += parseFloat(costText) || 0;
      }
      
      // Guarda o custo total de produ√ß√£o (mat√©rias primas + m√£o de obra) para uso posterior
      const productionCost = totalRaw + totalLabor;
      document.getElementById('sheetContent').dataset.productionCost = productionCost;
    }
    
    // Gera a ficha t√©cnica com base nas informa√ß√µes inseridas
    function generateSheet() {
      updateSummary();
      const productName = document.getElementById('productName').value || 'Produto Sem Nome';
      const profitMargin = parseFloat(document.getElementById('profitMargin').value) || 0;
      const productionCost = parseFloat(document.getElementById('sheetContent').dataset.productionCost) || 0;
      
      // F√≥rmula do pre√ßo: Custo Total / (1 - Margem de lucro)
      let salePrice = 0;
      if (profitMargin < 100) {
        salePrice = productionCost / (1 - (profitMargin / 100));
      } else {
        salePrice = productionCost; // Evita divis√£o por zero se a margem for 100%
      }
      
      let contentHTML = '';
      contentHTML += '<p><strong>Nome do Produto:</strong> ' + productName + '</p>';
      contentHTML += '<p><strong>Custo de Produ√ß√£o:</strong> ' + formatCurrency(productionCost) + '</p>';
      contentHTML += '<p><strong>Pre√ßo de Venda:</strong> ' + formatCurrency(salePrice) + '</p>';
      
      // Composi√ß√£o do Produto
      contentHTML += '<h3>Composi√ß√£o do Produto</h3>';
      
      // Listagem das Mat√©rias Primas
      contentHTML += '<h4>Mat√©rias Primas:</h4>';
      const rawRows = document.getElementById('rawMaterialsTable').getElementsByTagName('tbody')[0].rows;
      if (rawRows.length > 0) {
        contentHTML += '<ul>';
        for (let row of rawRows) {
          const desc = row.cells[0].querySelector('input').value || 'Sem descri√ß√£o';
          const qty = row.cells[1].querySelector('input').value || '0';
          const unit = row.cells[2].querySelector('select').value;
          const costUnit = parseFloat(row.cells[3].querySelector('input').value) || 0;
          const costTotalText = row.cells[4].querySelector('span').textContent;
          contentHTML += '<li>' + desc + ' - ' + qty + ' ' + unit + ' - Custo Unit√°rio: ' + formatCurrency(costUnit) + ' - Total: ' + costTotalText + '</li>';
        }
        contentHTML += '</ul>';
      } else {
        contentHTML += '<p>Nenhuma mat√©ria prima adicionada.</p>';
      }
      
      // Listagem da M√£o de Obra
      contentHTML += '<h4>M√£o de Obra:</h4>';
      const laborRows = document.getElementById('laborTable').getElementsByTagName('tbody')[0].rows;
      if (laborRows.length > 0) {
        contentHTML += '<ul>';
        for (let row of laborRows) {
          const time = row.cells[0].querySelector('input').value || '0';
          const unit = row.cells[1].querySelector('select').value;
          const costPerUnit = parseFloat(row.cells[2].querySelector('input').value) || 0;
          const costTotalText = row.cells[3].querySelector('span').textContent;
          contentHTML += '<li>' + time + ' ' + unit + ' - Custo por Unidade: ' + formatCurrency(costPerUnit) + ' - Total: ' + costTotalText + '</li>';
        }
        contentHTML += '</ul>';
      } else {
        contentHTML += '<p>Nenhuma m√£o de obra adicionada.</p>';
      }
      
      document.getElementById('sheetContent').innerHTML = contentHTML;
      document.getElementById('technicalSheet').style.display = 'block';
    }
    
    // Exporta a ficha t√©cnica para Excel (formato CSV)
    function exportToExcel() {
      let csvContent = "data:text/csv;charset=utf-8,";
      csvContent += "Nome do Produto," + (document.getElementById('productName').value || '') + "\r\n";
      csvContent += "Mat√©rias Primas\r\n";
      csvContent += "Descri√ß√£o,Quantidade,Unidade,Custo Unit√°rio,Custo Total\r\n";
      
      const rawRows = document.getElementById('rawMaterialsTable').getElementsByTagName('tbody')[0].rows;
      for (let row of rawRows) {
        const desc = row.cells[0].querySelector('input').value;
        const qty = row.cells[1].querySelector('input').value;
        const unit = row.cells[2].querySelector('select').value;
        const costUnit = formatCurrency(parseFloat(row.cells[3].querySelector('input').value) || 0);
        const costTotal = row.cells[4].querySelector('span').textContent;
        csvContent += desc + "," + qty + "," + unit + "," + costUnit + "," + costTotal + "\r\n";
      }
      
      csvContent += "\r\nM√£o de Obra\r\n";
      csvContent += "Tempo Gasto,Unidade,Custo por Unidade,Custo Total\r\n";
      
      const laborRows = document.getElementById('laborTable').getElementsByTagName('tbody')[0].rows;
      for (let row of laborRows) {
        const time = row.cells[0].querySelector('input').value;
        const unit = row.cells[1].querySelector('select').value;
        const costPerUnit = formatCurrency(parseFloat(row.cells[2].querySelector('input').value) || 0);
        const costTotal = row.cells[3].querySelector('span').textContent;
        csvContent += time + "," + unit + "," + costPerUnit + "," + costTotal + "\r\n";
      }
      
      const profitMargin = document.getElementById('profitMargin').value;
      csvContent += "\r\nMargem de Lucro," + profitMargin + "\r\n";
      
      const productionCost = document.getElementById('sheetContent').dataset.productionCost || "0";
      let salePrice = 0;
      if(parseFloat(profitMargin) < 100){
        salePrice = productionCost / (1 - (parseFloat(profitMargin) / 100));
      } else {
        salePrice = productionCost;
      }
      csvContent += "Custo de Produ√ß√£o," + formatCurrency(parseFloat(productionCost)) + "\r\n";
      csvContent += "Pre√ßo de Venda," + formatCurrency(parseFloat(salePrice)) + "\r\n";
      
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "ficha_tecnica.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // Exporta a ficha t√©cnica para PDF usando jsPDF
    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      
      let y = 10;
      doc.setFontSize(14);
      doc.text("Ficha T√©cnica do Produto üìù", 10, y);
      y += 10;
      
      const productName = document.getElementById('productName').value || 'Produto Sem Nome';
      doc.setFontSize(12);
      doc.text("Nome do Produto: " + productName, 10, y);
      y += 10;
      
      const productionCost = parseFloat(document.getElementById('sheetContent').dataset.productionCost) || 0;
      const profitMargin = parseFloat(document.getElementById('profitMargin').value) || 0;
      let salePrice = 0;
      if(profitMargin < 100){
        salePrice = productionCost / (1 - (profitMargin/100));
      } else {
        salePrice = productionCost;
      }
      
      doc.text("Custo de Produ√ß√£o: " + formatCurrency(productionCost), 10, y);
      y += 10;
      doc.text("Pre√ßo de Venda: " + formatCurrency(salePrice), 10, y);
      y += 10;
      
      // Composi√ß√£o do Produto
      doc.text("Composi√ß√£o do Produto:", 10, y);
      y += 10;
      
      // Mat√©rias Primas
      doc.text("Mat√©rias Primas:", 10, y);
      y += 10;
      const rawRows = document.getElementById('rawMaterialsTable').getElementsByTagName('tbody')[0].rows;
      for (let row of rawRows) {
        const desc = row.cells[0].querySelector('input').value || 'Sem descri√ß√£o';
        const qty = row.cells[1].querySelector('input').value || '0';
        const unit = row.cells[2].querySelector('select').value;
        const costUnit = formatCurrency(parseFloat(row.cells[3].querySelector('input').value) || 0);
        const costTotal = row.cells[4].querySelector('span').textContent;
        const line = desc + " - " + qty + " " + unit + " - Custo Unit√°rio: " + costUnit + " - Total: " + costTotal;
        doc.text(line, 10, y);
        y += 10;
        if (y > 280) {
          doc.addPage();
          y = 10;
        }
      }
      
      // M√£o de Obra
      doc.text("M√£o de Obra:", 10, y);
      y += 10;
      const laborRows = document.getElementById('laborTable').getElementsByTagName('tbody')[0].rows;
      for (let row of laborRows) {
        const time = row.cells[0].querySelector('input').value;
        const unit = row.cells[1].querySelector('select').value;
        const costPerUnit = formatCurrency(parseFloat(row.cells[2].querySelector('input').value) || 0);
        const costTotal = row.cells[3].querySelector('span').textContent;
        const line = time + " " + unit + " - Custo por Unidade: " + costPerUnit + " - Total: " + costTotal;
        doc.text(line, 10, y);
        y += 10;
        if (y > 280) {
          doc.addPage();
          y = 10;
        }
      }
      
      doc.save("ficha_tecnica.pdf");
    }
  </script>
</body>
</html>
